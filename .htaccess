# Configuración para PrestamosEdin
RewriteEngine On

# Configurar DirectoryIndex para evitar errores 403
DirectoryIndex index.php index.html index.htm

# Configuración para el dashboard
<IfModule mod_dir.c>
    DirectoryIndex index.php index.html index.htm
</IfModule>

# Permitir acceso a archivos estáticos
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|json|txt|woff|woff2|ttf|eot)$">
    Header set Cache-Control "public, max-age=31536000"
</FilesMatch>

# Configuración CORS para API
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    Header always set Access-Control-Max-Age "3600"
</IfModule>

# Manejar preflight requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Redirigir rutas de API al backend
RewriteCond %{REQUEST_URI} ^/api/(.*)$ [OR]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} api_postgres\.php
RewriteRule ^(.*)$ /index.php [QSA,L]

# Redirigir rutas del dashboard al frontend React
RewriteCond %{REQUEST_URI} ^/dashboard/(.*)$
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /index.php [QSA,L]

# Redirigir todas las rutas no encontradas al index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /index.php [QSA,L]

# Configuración de seguridad
<Files ".htaccess">
    Order allow,deny
    Deny from all
</Files>

# Ocultar archivos sensibles
<FilesMatch "\.(env|log|sql)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Configuración PHP
<IfModule mod_php.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value memory_limit 256M
</IfModule>